<div class="coupons-container">
  <mat-card>
    <mat-card-header>
      <mat-card-title>
        <mat-icon>local_offer</mat-icon>
        Gutscheine & Rabatte
      </mat-card-title>
      <div class="header-actions">
        <mat-form-field appearance="outline" class="filter-field">
          <mat-label>Status Filter</mat-label>
          <mat-select [(value)]="statusFilter" (selectionChange)="onFilterChange($event.value)">
            <mat-option value="">Alle</mat-option>
            <mat-option value="ACTIVE">Aktiv</mat-option>
            <mat-option value="PAUSED">Pausiert</mat-option>
            <mat-option value="ARCHIVED">Archiviert</mat-option>
          </mat-select>
        </mat-form-field>

        <button mat-stroked-button (click)="onImport()">
          <mat-icon>upload</mat-icon>
          Importieren
        </button>

        <button mat-stroked-button (click)="onExport()">
          <mat-icon>download</mat-icon>
          Exportieren
        </button>

        <button mat-raised-button color="primary" (click)="onCreate()">
          <mat-icon>add</mat-icon>
          Neuer Gutschein
        </button>
      </div>
    </mat-card-header>

    <mat-card-content>
      <div *ngIf="loading" class="loading-container">
        <mat-spinner diameter="40"></mat-spinner>
      </div>

      <div *ngIf="!loading && coupons.length === 0" class="empty-state">
        <mat-icon>local_offer</mat-icon>
        <p>Keine Gutscheine gefunden</p>
        <button mat-raised-button color="primary" (click)="onCreate()">
          Ersten Gutschein erstellen
        </button>
      </div>

      <table mat-table [dataSource]="coupons" *ngIf="!loading && coupons.length > 0" class="coupons-table">
        <!-- Code Column -->
        <ng-container matColumnDef="code">
          <th mat-header-cell *matHeaderCellDef>Code</th>
          <td mat-cell *matCellDef="let coupon">
            <strong>{{ coupon.code }}</strong>
            <mat-icon *ngIf="coupon.autoApply" class="auto-apply-icon" matTooltip="Auto-Apply">bolt</mat-icon>
          </td>
        </ng-container>

        <!-- Type Column -->
        <ng-container matColumnDef="type">
          <th mat-header-cell *matHeaderCellDef>Typ</th>
          <td mat-cell *matCellDef="let coupon">
            <mat-chip [color]="coupon.type === 'PERCENT' ? 'primary' : 'accent'" selected>
              {{ coupon.type }}
            </mat-chip>
          </td>
        </ng-container>

        <!-- Discount Column -->
        <ng-container matColumnDef="discount">
          <th mat-header-cell *matHeaderCellDef>Rabatt</th>
          <td mat-cell *matCellDef="let coupon">
            {{ getDiscountText(coupon) }}
          </td>
        </ng-container>

        <!-- Status Column -->
        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef>Status</th>
          <td mat-cell *matCellDef="let coupon">
            <mat-chip [color]="getStatusColor(coupon.status)" selected>
              {{ coupon.status }}
            </mat-chip>
          </td>
        </ng-container>

        <!-- Usage Column -->
        <ng-container matColumnDef="usage">
          <th mat-header-cell *matHeaderCellDef>Verwendungen</th>
          <td mat-cell *matCellDef="let coupon">
            {{ coupon.timesUsedTotal || 0 }}
            <span *ngIf="coupon.usageLimitTotal"> / {{ coupon.usageLimitTotal }}</span>
          </td>
        </ng-container>

        <!-- Dates Column -->
        <ng-container matColumnDef="dates">
          <th mat-header-cell *matHeaderCellDef>GÃ¼ltigkeitszeitraum</th>
          <td mat-cell *matCellDef="let coupon">
            <div class="date-range">
              <span>{{ formatDate(coupon.startsAt) }}</span>
              <span> - </span>
              <span>{{ formatDate(coupon.endsAt) }}</span>
            </div>
          </td>
        </ng-container>

        <!-- Actions Column -->
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef>Aktionen</th>
          <td mat-cell *matCellDef="let coupon">
            <button mat-icon-button [matMenuTriggerFor]="menu">
              <mat-icon>more_vert</mat-icon>
            </button>
            <mat-menu #menu="matMenu">
              <button mat-menu-item (click)="onEdit(coupon)">
                <mat-icon>edit</mat-icon>
                <span>Bearbeiten</span>
              </button>
              <button mat-menu-item (click)="onPause(coupon)" *ngIf="coupon.status === 'ACTIVE'">
                <mat-icon>pause</mat-icon>
                <span>Pausieren</span>
              </button>
              <button mat-menu-item (click)="onResume(coupon)" *ngIf="coupon.status === 'PAUSED'">
                <mat-icon>play_arrow</mat-icon>
                <span>Aktivieren</span>
              </button>
              <button mat-menu-item (click)="onArchive(coupon)" *ngIf="coupon.status !== 'ARCHIVED'">
                <mat-icon>archive</mat-icon>
                <span>Archivieren</span>
              </button>
            </mat-menu>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      </table>
    </mat-card-content>
  </mat-card>
</div>


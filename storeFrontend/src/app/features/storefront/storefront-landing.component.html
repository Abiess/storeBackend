<!-- Modern E-Commerce Storefront - Inspired by Amazon, Zalando, About You -->

<!-- Store nicht gefunden / Reservierter Slug -->
<app-store-not-found *ngIf="storeNotFound"></app-store-not-found>

<!-- Normaler Store-Inhalt -->
<div *ngIf="!storeNotFound" class="storefront-wrapper">
  <!-- Sticky Header mit Store-Name und Warenkorb -->
  <div class="sticky-header">
    <app-storefront-header
      [storeName]="storeName || 'Loading...'"
      [storeSlug]="storeName || ''"
      [cartItemCount]="cartItemCount"
      (cartClick)="router.navigate(['/cart'])">
    </app-storefront-header>

    <!-- Category Pills Navigation - Mobile First -->
    <div class="category-pills-wrapper" *ngIf="!loading && categories.length > 0">
      <div class="category-pills">
        <button
          class="category-pill"
          [class.active]="!selectedCategory"
          (click)="filterByCategory(null)">
          Alle
        </button>
        <button
          *ngFor="let cat of categories"
          class="category-pill"
          [class.active]="selectedCategory?.id === cat.id"
          (click)="filterByCategory(cat)">
          {{ cat.name }}
        </button>
      </div>
    </div>
  </div>

  <!-- Loading Indicator -->
  <div *ngIf="loading" class="loading-container">
    <div class="spinner"></div>
    <p>Store wird geladen...</p>
  </div>

  <!-- Main Content with Sidebar Layout -->
  <main class="storefront-main" *ngIf="!loading">
    <div class="page-container">

      <!-- Hero/Banner Section - Compact -->
      <section class="hero-banner">
        <div class="hero-content">
          <h1 class="hero-title">{{ storeName }}</h1>
          <p class="hero-subtitle">Entdecke unsere Produkte</p>
        </div>
      </section>

      <!-- Breadcrumbs -->
      <nav class="breadcrumbs" aria-label="breadcrumb">
        <ol>
          <li><a (click)="filterByCategory(null)">Home</a></li>
          <li *ngIf="selectedCategory" class="active">{{ selectedCategory.name }}</li>
        </ol>
      </nav>

      <!-- Products Layout: Sidebar + Grid -->
      <div class="products-layout">

        <!-- Sidebar with Filters (Desktop) -->
        <aside class="sidebar-filters">
          <div class="filter-section">
            <h3 class="filter-title">Kategorien</h3>
            <ul class="category-list">
              <li>
                <button
                  class="category-item"
                  [class.active]="!selectedCategory"
                  (click)="filterByCategory(null)">
                  <span>Alle Produkte</span>
                  <span class="count">({{ products.length }})</span>
                </button>
              </li>
              <li *ngFor="let cat of categories">
                <button
                  class="category-item"
                  [class.active]="selectedCategory?.id === cat.id"
                  (click)="filterByCategory(cat)">
                  <span>{{ cat.name }}</span>
                  <span class="count">({{ getProductCountForCategory(cat) }})</span>
                </button>
              </li>
            </ul>
          </div>
        </aside>

        <!-- Products Grid Area -->
        <div class="products-area">

          <!-- Toolbar with Sort & View Options -->
          <div class="products-toolbar">
            <div class="toolbar-left">
              <span class="result-count">
                {{ filteredProducts.length }} {{ filteredProducts.length === 1 ? 'Produkt' : 'Produkte' }}
                <span *ngIf="selectedCategory"> in {{ selectedCategory.name }}</span>
              </span>
            </div>
            <div class="toolbar-right">
              <label for="sortSelect" class="sr-only">Sortieren</label>
              <select id="sortSelect" class="sort-select" (change)="onSortChange($event)">
                <option value="relevant">Relevanz</option>
                <option value="price-asc">Preis aufsteigend</option>
                <option value="price-desc">Preis absteigend</option>
                <option value="name-asc">Name A-Z</option>
                <option value="newest">Neueste zuerst</option>
              </select>
            </div>
          </div>

          <!-- Featured Products Section -->
          <section *ngIf="featuredProducts.length > 0 && !selectedCategory" class="featured-products-section">
            <h2 class="section-heading">‚≠ê Highlights</h2>
            <div class="products-grid featured">
              <app-product-card
                *ngFor="let product of featuredProducts.slice(0, 4)"
                [product]="product"
                (addToCart)="addToCart($event)"
                (quickView)="openQuickView($event)"
                (click)="trackProductView(product)">
              </app-product-card>
            </div>
          </section>

          <!-- Bestsellers Section -->
          <section *ngIf="topProducts.length > 0 && !selectedCategory" class="bestsellers-section">
            <h2 class="section-heading">üî• Bestseller</h2>
            <div class="products-grid">
              <app-product-card
                *ngFor="let product of topProducts.slice(0, 4)"
                [product]="product"
                (addToCart)="addToCart($event)"
                (quickView)="openQuickView($event)"
                (click)="trackProductView(product)">
              </app-product-card>
            </div>
          </section>

          <!-- New Arrivals -->
          <section *ngIf="newArrivals.length > 0 && !selectedCategory" class="new-arrivals-section">
            <h2 class="section-heading">‚ú® Neu eingetroffen</h2>
            <div class="products-grid">
              <app-product-card
                *ngFor="let product of newArrivals.slice(0, 4)"
                [product]="product"
                (addToCart)="addToCart($event)"
                (quickView)="openQuickView($event)"
                (click)="trackProductView(product)">
              </app-product-card>
            </div>
          </section>

          <!-- All Products Section -->
          <section class="all-products-section">
            <h2 class="section-heading" *ngIf="!selectedCategory">Alle Produkte</h2>

            <!-- Empty State -->
            <div *ngIf="filteredProducts.length === 0" class="empty-state">
              <div class="empty-icon">{{ selectedCategory ? 'üîç' : 'üì¶' }}</div>
              <h3>{{ selectedCategory ? 'Keine Produkte gefunden' : 'Noch keine Produkte verf√ºgbar' }}</h3>
              <p>{{ selectedCategory ? 'In dieser Kategorie sind aktuell keine Produkte verf√ºgbar.' : 'Wir arbeiten daran, neue Produkte bereitzustellen.' }}</p>
              <button *ngIf="selectedCategory" class="btn-primary" (click)="filterByCategory(null)">
                Alle Produkte anzeigen
              </button>
            </div>

            <!-- Products Grid -->
            <div *ngIf="filteredProducts.length > 0" class="products-grid main">
              <app-product-card
                *ngFor="let product of filteredProducts"
                [product]="product"
                (addToCart)="addToCart($event)"
                (quickView)="openQuickView($event)"
                (click)="trackProductView(product)">
              </app-product-card>
            </div>
          </section>

        </div><!-- End products-area -->
      </div><!-- End products-layout -->

    </div><!-- End page-container -->
  </main>

  <!-- Quick View Modal -->
  <app-product-quick-view
    [product]="quickViewProduct"
    [isOpen]="isQuickViewOpen"
    (close)="closeQuickView()"
    (addToCartEvent)="onQuickViewAddToCart($event)"
    (viewDetailsEvent)="onQuickViewDetails($event)">
  </app-product-quick-view>

</div><!-- End storefront-wrapper -->

<!-- Footer -->
<footer class="storefront-footer">
  <div class="footer-container">
    <p>&copy; 2026 {{ storeName || 'Store' }} ¬∑ Powered by Markt.ma</p>
  </div>
</footer>

<!-- Storefront Landing Page Template -->

<!-- NEUE: Store nicht gefunden / Reservierter Slug -->
<app-store-not-found *ngIf="storeNotFound"></app-store-not-found>

<!-- Normaler Store-Inhalt -->
<div *ngIf="!storeNotFound">
  <!-- Header mit Store-Name und Warenkorb -->
  <app-storefront-header
    [storeName]="storeName || 'Loading...'"
    [storeSlug]="storeName || ''"
    [cartItemCount]="cartItemCount"
    (cartClick)="router.navigate(['/cart'])">
  </app-storefront-header>

  <!-- Navigation mit Kategorien -->
  <app-storefront-nav
    *ngIf="categories.length > 0"
    [categories]="categories"
    (categorySelect)="filterByCategory($event)">
  </app-storefront-nav>

  <!-- Loading Indicator -->
  <div *ngIf="loading" class="loading-container">
    <div class="spinner"></div>
    <p>Store wird geladen...</p>
  </div>

  <!-- Main Content -->
  <main class="storefront-content" *ngIf="!loading">

    <!-- Hero Section -->
    <section class="hero-section">
      <div class="container">
        <h2>Willkommen bei {{ storeName }}</h2>
        <p class="hero-description">Entdecke unsere Produkte</p>
        <button class="btn btn-primary" (click)="scrollToProducts()">
          Produkte ansehen
        </button>
      </div>
    </section>

    <!-- Featured Products Section -->
    <section *ngIf="featuredProducts.length > 0" class="featured-section">
      <div class="container">
        <div class="section-header">
          <h3 class="section-title">‚≠ê Unsere Highlights</h3>
          <p class="section-subtitle">Speziell f√ºr dich ausgew√§hlt</p>
        </div>

        <div class="products-grid featured-grid">
          <app-product-card
            *ngFor="let product of featuredProducts"
            [product]="product"
            (addToCart)="addToCart($event)"
            (quickView)="openQuickView($event)"
            (click)="trackProductView(product)">
          </app-product-card>
        </div>
      </div>
    </section>

    <!-- Top Products (Bestseller) Section -->
    <section *ngIf="topProducts.length > 0" class="top-products-section">
      <div class="container">
        <div class="section-header">
          <h3 class="section-title">üî• Bestseller</h3>
          <p class="section-subtitle">Die meistverkauften Produkte</p>
        </div>

        <div class="products-grid">
          <app-product-card
            *ngFor="let product of topProducts"
            [product]="product"
            (addToCart)="addToCart($event)"
            (quickView)="openQuickView($event)"
            (click)="trackProductView(product)">
          </app-product-card>
        </div>

        <!-- Sales Badge f√ºr Bestseller -->
        <div class="bestseller-info" *ngIf="topProducts[0]?.salesCount">
          <p>üí∞ √úber {{ topProducts[0].salesCount }} mal verkauft!</p>
        </div>
      </div>
    </section>

    <!-- New Arrivals Section -->
    <section *ngIf="newArrivals.length > 0" class="new-arrivals-section">
      <div class="container">
        <div class="section-header">
          <h3 class="section-title">‚ú® Neu eingetroffen</h3>
          <p class="section-subtitle">Die neuesten Produkte in unserem Shop</p>
        </div>

        <div class="products-grid">
          <app-product-card
            *ngFor="let product of newArrivals"
            [product]="product"
            (addToCart)="addToCart($event)"
            (quickView)="openQuickView($event)"
            (click)="trackProductView(product)">
          </app-product-card>
        </div>
      </div>
    </section>

    <!-- Products Section -->
    <section id="products" class="products-section">
      <div class="container">
        <h3 class="section-title">Alle Produkte</h3>

        <!-- Keine Produkte vorhanden -->
        <div *ngIf="products.length === 0" class="empty-state">
          <div class="empty-icon">üì¶</div>
          <h4>Noch keine Produkte verf√ºgbar</h4>
          <p>Der Store-Besitzer hat noch keine Produkte hinzugef√ºgt.</p>
        </div>

        <!-- Produkte Grid -->
        <div *ngIf="products.length > 0" class="products-grid">
          <app-product-card
            *ngFor="let product of products"
            [product]="product"
            (addToCart)="addToCart($event)"
            (quickView)="openQuickView($event)"
            (click)="trackProductView(product)">
          </app-product-card>
        </div>
      </div>
    </section>

    <!-- Categories Section (wenn vorhanden) -->
    <section *ngIf="categories.length > 0" class="categories-section">
      <div class="container">
        <h3 class="section-title">Kategorien</h3>
        <div class="categories-grid">
          <div
            *ngFor="let category of categories"
            class="category-card"
            (click)="filterByCategory(category)">
            <h4>{{ category.name }}</h4>
            <p *ngIf="category.description">{{ category.description }}</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Debug Info (nur f√ºr Entwicklung) -->
    <section class="debug-section" *ngIf="false">
      <div class="container">
        <details>
          <summary>üîß Debug Info</summary>
          <pre>{{ {
            storeId: storeId,
            storeName: storeName,
            productsCount: products.length,
            categoriesCount: categories.length,
            featuredCount: featuredProducts.length,
            topProductsCount: topProducts.length,
            newArrivalsCount: newArrivals.length,
            cartItemCount: cartItemCount
          } | json }}</pre>
        </details>
      </div>
    </section>

  </main>

  <!-- Quick View Modal -->
  <app-product-quick-view
    [product]="quickViewProduct"
    [isOpen]="isQuickViewOpen"
    (close)="closeQuickView()"
    (addToCartEvent)="onQuickViewAddToCart($event)"
    (viewDetailsEvent)="onQuickViewDetails($event)">
  </app-product-quick-view>
</div>

<!-- Footer -->
<footer class="storefront-footer">
  <div class="container">
    <p>&copy; 2026 {{ storeName || 'Store' }} - Powered by Markt.ma</p>
  </div>
</footer>

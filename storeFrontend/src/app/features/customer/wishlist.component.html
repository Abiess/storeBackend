<div class="wishlist-container">
  <div class="header">
    <h2><i class="fas fa-heart"></i> {{ 'wishlist.title' | translate }}</h2>
    <button class="btn btn-primary" (click)="addAllToCart()" *ngIf="currentWishlist && currentWishlist.items && currentWishlist.items.length > 0">
      <i class="fas fa-cart-plus"></i> {{ 'wishlist.addAllToCart' | translate }}
    </button>
  </div>

  <!-- ✅ Login-Aufforderung für Gäste -->
  <div class="login-prompt" *ngIf="showLoginPrompt && !loading">
    <div class="prompt-card">
      <i class="fas fa-lock"></i>
      <h3>{{ 'wishlist.loginRequired' | translate }}</h3>
      <p>{{ 'wishlist.loginMessage' | translate }}</p>
      <button class="btn btn-primary btn-lg" (click)="goToLogin()">
        <i class="fas fa-sign-in-alt"></i> {{ 'auth.login' | translate }}
      </button>
      <button class="btn btn-secondary" [routerLink]="['/']">
        <i class="fas fa-shopping-bag"></i> {{ 'cart.continueShopping' | translate }}
      </button>
    </div>
  </div>

  <!-- Wishlist Tabs -->
  <div class="wishlist-tabs" *ngIf="wishlists.length > 1 && !showLoginPrompt">
    <button
      *ngFor="let wishlist of wishlists"
      class="tab-button"
      [class.active]="currentWishlist?.id === wishlist.id"
      (click)="selectWishlist(wishlist)">
      {{ wishlist.name }}
      <span class="item-count">{{ wishlist.items.length || 0 }}</span>
    </button>
  </div>

  <!-- Wishlist Items -->
  <div class="wishlist-items" *ngIf="!loading && !showLoginPrompt && currentWishlist && currentWishlist.items && currentWishlist.items.length > 0">
    <div class="wishlist-item" *ngFor="let item of currentWishlist.items">
      <div class="item-image" (click)="viewProduct(item)">
        <img [src]="getProductImage(item)" [alt]="item.productTitle || 'Product'" />
        <div class="priority-badge" [class]="getPriorityClass(item.priority)" *ngIf="item.priority">
          <i [class]="getPriorityIcon(item.priority)"></i>
        </div>
      </div>

      <div class="item-details">
        <h3 class="item-title" (click)="viewProduct(item)">
          {{ item.productTitle }}
        </h3>
        <p class="item-note" *ngIf="item.note">
          <i class="fas fa-sticky-note"></i> {{ item.note }}
        </p>
        <p class="item-date">
          <i class="fas fa-calendar"></i> {{ 'wishlist.addedOn' | translate }} {{ item.addedAt | date: 'dd.MM.yyyy' }}
        </p>
      </div>

      <div class="item-price">
        <span class="price">{{ item.productPrice | currency: 'EUR' }}</span>
        <span class="stock-status" *ngIf="item.inStock !== undefined">
          <i class="fas fa-check-circle" *ngIf="item.inStock"></i>
          <i class="fas fa-times-circle" *ngIf="!item.inStock"></i>
          {{ item.inStock ? ('wishlist.inStock' | translate) : ('wishlist.outOfStock' | translate) }}
        </span>
      </div>

      <div class="item-actions">
        <button class="btn btn-primary" (click)="addToCart(item)" [disabled]="!item.inStock">
          <i class="fas fa-cart-plus"></i> {{ 'wishlist.addToCart' | translate }}
        </button>
        <button class="btn btn-icon" (click)="viewProduct(item)" [title]="'wishlist.viewProduct' | translate">
          <i class="fas fa-eye"></i>
        </button>
        <button class="btn btn-icon btn-danger" (click)="removeFromWishlist(item)" [title]="'common.remove' | translate">
          <i class="fas fa-trash"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- Empty State -->
  <div class="empty-state" *ngIf="!loading && !showLoginPrompt && currentWishlist && (!currentWishlist.items || currentWishlist.items.length === 0)">
    <i class="fas fa-heart-broken"></i>
    <h3>{{ 'wishlist.empty' | translate }}</h3>
    <p>{{ 'wishlist.addProducts' | translate }}</p>
    <button class="btn btn-primary" [routerLink]="['/']">
      <i class="fas fa-shopping-bag"></i> {{ 'cart.continueShopping' | translate }}
    </button>
  </div>

  <!-- No Wishlists State -->
  <div class="empty-state" *ngIf="!loading && !showLoginPrompt && wishlists.length === 0">
    <i class="fas fa-heart"></i>
    <h3>{{ 'wishlist.empty' | translate }}</h3>
    <p>{{ 'wishlist.addProducts' | translate }}</p>
  </div>

  <!-- Loading State -->
  <div class="loading-state" *ngIf="loading">
    <div class="spinner"></div>
    <p>{{ 'common.loading' | translate }}</p>
  </div>
</div>

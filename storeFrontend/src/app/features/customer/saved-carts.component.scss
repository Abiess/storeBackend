.saved-carts-container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 2rem;
}

.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 2rem;

  h2 {
    margin: 0;
    font-size: 1.8rem;
    color: #333;

    i {
      color: #ff9800;
      margin-right: 0.5rem;
    }
  }
}

.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.5);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
}

.modal-content {
  background: white;
  padding: 2rem;
  border-radius: 8px;
  max-width: 500px;
  width: 90%;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);

  h3 {
    margin-top: 0;
    margin-bottom: 1.5rem;
  }
}

.form-group {
  margin-bottom: 1.5rem;

  label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 500;
    color: #555;
  }

  .form-control {
    width: 100%;
    padding: 0.75rem;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-size: 1rem;

    &:focus {
      outline: none;
      border-color: #ff9800;
    }
  }

  textarea.form-control {
    resize: vertical;
    font-family: inherit;
  }
}

.modal-actions {
  display: flex;
  gap: 1rem;
  justify-content: flex-end;
  margin-top: 2rem;
}

.saved-carts-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
  gap: 1.5rem;
}

.saved-cart-card {
  background: white;
  border-radius: 8px;
  padding: 1.5rem;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  transition: transform 0.3s, box-shadow 0.3s;

  &:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  }

  &.expired {
    border: 2px solid #ffc107;
  }
}

.cart-header {
  margin-bottom: 1.5rem;

  h3 {
    margin: 0 0 0.5rem 0;
    font-size: 1.3rem;
    color: #333;
  }

  .cart-date {
    margin: 0.25rem 0;
    color: #999;
    font-size: 0.9rem;

    i {
      margin-right: 0.5rem;
    }
  }

  .cart-description {
    margin: 0.5rem 0 0 0;
    color: #666;
    font-size: 0.95rem;
    font-style: italic;
  }
}

.cart-stats {
  display: flex;
  gap: 1rem;
  margin-top: 1rem;

  .item-count {
    padding: 0.5rem 1rem;
    background: #e3f2fd;
    color: #1976d2;
    border-radius: 20px;
    font-size: 0.9rem;
    font-weight: 500;
  }

  .total-amount {
    padding: 0.5rem 1rem;
    background: #e8f5e9;
    color: #388e3c;
    border-radius: 20px;
    font-size: 0.9rem;
    font-weight: 700;
  }
}

.cart-items-preview {
  margin-bottom: 1rem;
  padding: 1rem;
  background: #f8f9fa;
  border-radius: 4px;
}

.item-preview {
  display: flex;
  gap: 1rem;
  margin-bottom: 0.75rem;

  &:last-child {
    margin-bottom: 0;
  }

  img {
    width: 50px;
    height: 50px;
    object-fit: cover;
    border-radius: 4px;
  }

  .item-info {
    flex: 1;

    .item-name {
      margin: 0;
      font-size: 0.9rem;
      color: #333;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .item-quantity {
      margin: 0.25rem 0 0 0;
      font-size: 0.85rem;
      color: #666;
    }
  }
}

.more-items {
  margin: 0.75rem 0 0 0;
  text-align: center;
  color: #999;
  font-size: 0.9rem;
  font-style: italic;
}

.expired-notice {
  padding: 0.75rem;
  background: #fff3e0;
  border-left: 3px solid #ffc107;
  border-radius: 4px;
  color: #f57c00;
  font-size: 0.9rem;
  margin-bottom: 1rem;

  i {
    margin-right: 0.5rem;
  }
}

.cart-actions {
  display: flex;
  gap: 0.5rem;
  flex-wrap: wrap;
}

.btn {
  padding: 0.75rem 1.5rem;
  border: none;
  border-radius: 4px;
  font-size: 0.95rem;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.3s;

  &:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  i {
    margin-right: 0.5rem;
  }
}

.btn-primary {
  background: #ff9800;
  color: white;

  &:hover:not(:disabled) {
    background: #f57c00;
  }
}

.btn-secondary {
  background: #6c757d;
  color: white;

  &:hover {
    background: #5a6268;
  }
}

.btn-outline {
  background: transparent;
  border: 1px solid #ff9800;
  color: #ff9800;

  &:hover {
    background: #ff9800;
    color: white;
  }
}

.btn-danger-outline {
  background: transparent;
  border: 1px solid #f44336;
  color: #f44336;
  padding: 0.75rem 1rem;

  &:hover {
    background: #f44336;
    color: white;
  }

  i {
    margin: 0;
  }
}

.empty-state {
  text-align: center;
  padding: 4rem 2rem;
  background: white;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);

  i {
    font-size: 4rem;
    color: #ff9800;
    margin-bottom: 1rem;
  }

  h3 {
    margin: 0 0 1rem 0;
    color: #333;
  }

  p {
    color: #666;
    margin-bottom: 1.5rem;
  }
}

.loading-state {
  text-align: center;
  padding: 4rem 2rem;

  .spinner {
    width: 50px;
    height: 50px;
    border: 4px solid #f3f3f3;
    border-top: 4px solid #ff9800;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin: 0 auto 1rem;
  }

  p {
    color: #666;
  }
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
import { Component, OnInit } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';
import { SavedCartService } from '@app/core/services/saved-cart.service';
import { CartService } from '@app/core/services/cart.service';
import { SavedCart, SavedCartItem } from '@app/core/models';
import { SubdomainService } from '@app/core/services/subdomain.service';

@Component({
  selector: 'app-saved-carts',
  standalone: true,
  imports: [CommonModule, FormsModule],
  templateUrl: './saved-carts.component.html',
  styleUrls: ['./saved-carts.component.scss']
})
export class SavedCartsComponent implements OnInit {
  savedCarts: SavedCart[] = [];
  loading = false;
  storeId: number | null = null;
  showSaveDialog = false;
  newCartName = '';
  newCartDescription = '';

  constructor(
    private savedCartService: SavedCartService,
    private cartService: CartService,
    private subdomainService: SubdomainService
  ) {}

  ngOnInit(): void {
    this.subdomainService.resolveStore().subscribe(info => {
      if (info.storeId) {
        this.storeId = info.storeId;
        this.loadSavedCarts();
      }
    });
  }

  loadSavedCarts(): void {
    if (!this.storeId) return;

    this.loading = true;
    this.savedCartService.getSavedCarts(this.storeId).subscribe({
      next: (carts) => {
        this.savedCarts = carts;
        this.loading = false;
      },
      error: (error) => {
        console.error('Fehler beim Laden der gespeicherten Warenkörbe:', error);
        this.loading = false;
      }
    });
  }

  openSaveDialog(): void {
    this.showSaveDialog = true;
    this.newCartName = '';
    this.newCartDescription = '';
  }

  closeSaveDialog(): void {
    this.showSaveDialog = false;
  }

  saveCurrentCart(): void {
    if (!this.storeId || !this.newCartName.trim()) return;

    this.cartService.getCart().subscribe({
      next: (cart) => {
        if (!this.storeId) return;

        this.savedCartService.saveCurrentCart({
          storeId: this.storeId,
          name: this.newCartName.trim(),
          description: this.newCartDescription.trim(),
          cartId: cart.id
        }).subscribe({
          next: () => {
            this.loadSavedCarts();
            this.closeSaveDialog();
          },
          error: (error) => {
            console.error('Fehler beim Speichern des Warenkorbs:', error);
          }
        });
      },
      error: (error) => {
        console.error('Fehler beim Abrufen des Warenkorbs:', error);
      }
    });
  }

  restoreCart(savedCart: SavedCart, merge: boolean = false): void {
    if (!this.storeId) return;

    if (!merge && !confirm('Möchten Sie den aktuellen Warenkorb durch diesen ersetzen?')) {
      return;
    }

    this.savedCartService.restoreSavedCart(this.storeId, {
      savedCartId: savedCart.id,
      mergeWithCurrent: merge
    }).subscribe({
      next: () => {
        console.log('✅ Warenkorb wiederhergestellt');
      },
      error: (error) => {
        console.error('❌ Fehler beim Wiederherstellen des Warenkorbs:', error);
      }
    });
  }

  deleteCart(savedCart: SavedCart): void {
    if (!this.storeId) return;

    if (confirm(`Möchten Sie "${savedCart.name}" wirklich löschen?`)) {
      this.savedCartService.deleteSavedCart(this.storeId, savedCart.id).subscribe({
        next: () => {
          this.loadSavedCarts();
        },
        error: (error) => {
          console.error('Fehler beim Löschen des gespeicherten Warenkorbs:', error);
        }
      });
    }
  }

  getProductImage(item: SavedCartItem): string {
    return item.product?.primaryImageUrl || item.product?.imageUrl || 'assets/images/placeholder.png';
  }

  isExpired(savedCart: SavedCart): boolean {
    if (!savedCart.expiresAt) return false;
    return new Date(savedCart.expiresAt) < new Date();
  }
}


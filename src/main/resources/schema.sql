-- H2-kompatibles Database Schema
-- Verwendet GENERATED BY DEFAULT AS IDENTITY fuer H2 2.x Kompatibilitaet

-- Loesche existierende Tabellen (in korrekter Reihenfolge wegen Foreign Keys)
DROP TABLE IF EXISTS chat_analytics CASCADE;
DROP TABLE IF EXISTS chat_messages CASCADE;
DROP TABLE IF EXISTS chat_sessions CASCADE;
DROP TABLE IF EXISTS chatbot_intents CASCADE;
DROP TABLE IF EXISTS faq_items CASCADE;
DROP TABLE IF EXISTS faq_categories CASCADE;
DROP TABLE IF EXISTS email_verification_tokens CASCADE;
DROP TABLE IF EXISTS password_reset_tokens CASCADE;
DROP TABLE IF EXISTS review_votes CASCADE;
DROP TABLE IF EXISTS product_reviews CASCADE;
DROP TABLE IF EXISTS wishlist_items CASCADE;
DROP TABLE IF EXISTS wishlists CASCADE;
DROP TABLE IF EXISTS customer_profiles CASCADE;
DROP TABLE IF EXISTS store_delivery_settings CASCADE;
DROP TABLE IF EXISTS store_themes CASCADE;
DROP TABLE IF EXISTS coupon_redemptions CASCADE;
DROP TABLE IF EXISTS coupon_domain_ids CASCADE;
DROP TABLE IF EXISTS coupon_customer_emails CASCADE;
DROP TABLE IF EXISTS coupon_collection_ids CASCADE;
DROP TABLE IF EXISTS coupon_category_ids CASCADE;
DROP TABLE IF EXISTS coupon_product_ids CASCADE;
DROP TABLE IF EXISTS coupons CASCADE;
DROP TABLE IF EXISTS cart_items CASCADE;
DROP TABLE IF EXISTS carts CASCADE;
DROP TABLE IF EXISTS order_items CASCADE;
DROP TABLE IF EXISTS order_status_history CASCADE;
DROP TABLE IF EXISTS orders CASCADE;
DROP TABLE IF EXISTS inventory_logs CASCADE;
DROP TABLE IF EXISTS product_media CASCADE;
DROP TABLE IF EXISTS product_variants CASCADE;
DROP TABLE IF EXISTS product_option_values CASCADE;
DROP TABLE IF EXISTS product_options CASCADE;
DROP TABLE IF EXISTS products CASCADE;
DROP TABLE IF EXISTS categories CASCADE;
DROP TABLE IF EXISTS media CASCADE;
DROP TABLE IF EXISTS store_slider_images CASCADE;
DROP TABLE IF EXISTS store_slider_settings CASCADE;
DROP TABLE IF EXISTS default_slider_images CASCADE;
DROP TABLE IF EXISTS domains CASCADE;
DROP TABLE IF EXISTS store_usage CASCADE;
DROP TABLE IF EXISTS stores CASCADE;
DROP TABLE IF EXISTS user_roles CASCADE;
DROP TABLE IF EXISTS users CASCADE;
DROP TABLE IF EXISTS plans CASCADE;
DROP TABLE IF EXISTS audit_logs CASCADE;
DROP TABLE IF EXISTS redirect_rules CASCADE;

-- Plans Tabelle
CREATE TABLE IF NOT EXISTS plans (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name VARCHAR(50) NOT NULL UNIQUE,
    max_stores INTEGER NOT NULL,
    max_custom_domains INTEGER NOT NULL,
    max_subdomains INTEGER NOT NULL,
    max_storage_mb BIGINT NOT NULL,
    max_products INTEGER NOT NULL,
    max_image_count INTEGER NOT NULL
);

-- Users Tabelle
CREATE TABLE IF NOT EXISTS users (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    email VARCHAR(255) NOT NULL UNIQUE,
    name VARCHAR(255),
    password_hash VARCHAR(255) NOT NULL,
    plan_id BIGINT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    email_verified BOOLEAN DEFAULT FALSE,
    FOREIGN KEY (plan_id) REFERENCES plans(id) ON DELETE SET NULL
);

-- User Roles
CREATE TABLE IF NOT EXISTS user_roles (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    user_id BIGINT NOT NULL,
    role VARCHAR(50) NOT NULL,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);

-- Stores Tabelle
CREATE TABLE IF NOT EXISTS stores (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    owner_id BIGINT NOT NULL,
    name VARCHAR(255) NOT NULL,
    slug VARCHAR(255) NOT NULL UNIQUE,
    description VARCHAR(10000),
    logo_url VARCHAR(500),
    status VARCHAR(50) NOT NULL DEFAULT 'ACTIVE',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (owner_id) REFERENCES users(id) ON DELETE CASCADE
);

-- Store Usage
CREATE TABLE IF NOT EXISTS store_usage (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    store_id BIGINT NOT NULL UNIQUE,
    storage_bytes BIGINT DEFAULT 0,
    image_count INTEGER DEFAULT 0,
    product_count INTEGER DEFAULT 0,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (store_id) REFERENCES stores(id) ON DELETE CASCADE
);

-- Domains Tabelle
CREATE TABLE IF NOT EXISTS domains (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    store_id BIGINT NOT NULL,
    host VARCHAR(255) NOT NULL UNIQUE,
    type VARCHAR(50) NOT NULL,
    is_primary BOOLEAN DEFAULT FALSE,
    is_verified BOOLEAN DEFAULT FALSE,
    verification_token VARCHAR(255),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (store_id) REFERENCES stores(id) ON DELETE CASCADE
);

-- Media Tabelle
CREATE TABLE IF NOT EXISTS media (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    store_id BIGINT NOT NULL,
    file_name VARCHAR(255) NOT NULL,
    original_name VARCHAR(255),
    mime_type VARCHAR(100),
    size_bytes BIGINT,
    url VARCHAR(500),
    alt_text VARCHAR(255),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (store_id) REFERENCES stores(id) ON DELETE CASCADE
);

-- Categories Tabelle
CREATE TABLE IF NOT EXISTS categories (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    store_id BIGINT NOT NULL,
    name VARCHAR(255) NOT NULL,
    slug VARCHAR(255) NOT NULL,
    description VARCHAR(10000),
    parent_id BIGINT,
    sort_order INTEGER DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (store_id) REFERENCES stores(id) ON DELETE CASCADE,
    FOREIGN KEY (parent_id) REFERENCES categories(id) ON DELETE SET NULL,
    UNIQUE (store_id, slug)
);

-- Products Tabelle
CREATE TABLE IF NOT EXISTS products (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    store_id BIGINT NOT NULL,
    category_id BIGINT,
    title VARCHAR(255) NOT NULL,
    sku VARCHAR(100),
    description VARCHAR(10000),
    base_price DECIMAL(10,2) NOT NULL,
    status VARCHAR(50) NOT NULL DEFAULT 'DRAFT',
    is_featured BOOLEAN DEFAULT FALSE,
    featured_order INTEGER DEFAULT 0,
    view_count BIGINT DEFAULT 0,
    sales_count BIGINT DEFAULT 0,
    average_rating DECIMAL(3,2) DEFAULT 0.0,
    review_count INTEGER DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (store_id) REFERENCES stores(id) ON DELETE CASCADE,
    FOREIGN KEY (category_id) REFERENCES categories(id) ON DELETE SET NULL
);

CREATE INDEX IF NOT EXISTS idx_products_featured ON products(store_id, is_featured, featured_order);
CREATE INDEX IF NOT EXISTS idx_products_sales_count ON products(store_id, sales_count);
CREATE INDEX IF NOT EXISTS idx_products_view_count ON products(store_id, view_count);
CREATE INDEX IF NOT EXISTS idx_products_created_at ON products(store_id, created_at);
CREATE INDEX IF NOT EXISTS idx_products_rating ON products(average_rating DESC);

-- Product Options
CREATE TABLE IF NOT EXISTS product_options (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    product_id BIGINT NOT NULL,
    name VARCHAR(100) NOT NULL,
    display_order INTEGER DEFAULT 0,
    FOREIGN KEY (product_id) REFERENCES products(id) ON DELETE CASCADE
);

-- Product Option Values
CREATE TABLE IF NOT EXISTS product_option_values (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    option_id BIGINT NOT NULL,
    option_value VARCHAR(100) NOT NULL,
    display_order INTEGER DEFAULT 0,
    FOREIGN KEY (option_id) REFERENCES product_options(id) ON DELETE CASCADE
);

-- Product Variants
CREATE TABLE IF NOT EXISTS product_variants (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    product_id BIGINT NOT NULL,
    sku VARCHAR(100),
    barcode VARCHAR(100),
    price DECIMAL(10,2),
    compare_price DECIMAL(10,2),
    cost_price DECIMAL(10,2),
    quantity INTEGER DEFAULT 0,
    weight DECIMAL(10,2),
    option1 VARCHAR(100),
    option2 VARCHAR(100),
    option3 VARCHAR(100),
    image_url VARCHAR(500),
    is_active BOOLEAN DEFAULT TRUE,
    FOREIGN KEY (product_id) REFERENCES products(id) ON DELETE CASCADE
);

-- Product Media (Bilder zu Produkten)
CREATE TABLE IF NOT EXISTS product_media (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    product_id BIGINT NOT NULL,
    media_id BIGINT NOT NULL,
    sort_order INTEGER DEFAULT 0,
    is_primary BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT product_media_product_media_unique UNIQUE (product_id, media_id),
    FOREIGN KEY (product_id) REFERENCES products(id) ON DELETE CASCADE,
    FOREIGN KEY (media_id) REFERENCES media(id) ON DELETE CASCADE
);

-- Inventory Logs
CREATE TABLE IF NOT EXISTS inventory_logs (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    variant_id BIGINT NOT NULL,
    quantity_change INTEGER NOT NULL,
    reason VARCHAR(50) NOT NULL,
    user_id BIGINT,
    notes TEXT,
    logged_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (variant_id) REFERENCES product_variants(id) ON DELETE CASCADE,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE SET NULL
);

-- Orders Tabelle
CREATE TABLE IF NOT EXISTS orders (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    store_id BIGINT NOT NULL,
    customer_id BIGINT,
    order_number VARCHAR(50) NOT NULL UNIQUE,
    customer_email VARCHAR(255),
    status VARCHAR(50) NOT NULL DEFAULT 'PENDING',
    tracking_number VARCHAR(100),
    total_amount DECIMAL(10,2) NOT NULL,
    notes VARCHAR(10000),
    -- Shipping Address
    shipping_first_name VARCHAR(255),
    shipping_last_name VARCHAR(255),
    shipping_address1 VARCHAR(500),
    shipping_address2 VARCHAR(500),
    shipping_city VARCHAR(100),
    shipping_postal_code VARCHAR(20),
    shipping_country VARCHAR(100),
    shipping_phone VARCHAR(50),
    -- Billing Address
    billing_first_name VARCHAR(255),
    billing_last_name VARCHAR(255),
    billing_address1 VARCHAR(500),
    billing_address2 VARCHAR(500),
    billing_city VARCHAR(100),
    billing_postal_code VARCHAR(20),
    billing_country VARCHAR(100),
    billing_phone VARCHAR(50),
    -- Delivery Fields
    delivery_type VARCHAR(20),
    delivery_mode VARCHAR(20),
    delivery_provider_id BIGINT,
    delivery_fee DECIMAL(10,2),
    eta_minutes INTEGER,
    -- Payment Fields (Cash on Delivery Support)
    payment_method VARCHAR(30),
    phone_verification_id BIGINT,
    phone_verified BOOLEAN DEFAULT FALSE,
    -- Timestamps
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    shipped_at TIMESTAMP,
    delivered_at TIMESTAMP,
    cancelled_at TIMESTAMP,
    FOREIGN KEY (store_id) REFERENCES stores(id) ON DELETE CASCADE,
    FOREIGN KEY (customer_id) REFERENCES users(id) ON DELETE SET NULL
);

-- Order Status History
CREATE TABLE IF NOT EXISTS order_status_history (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    order_id BIGINT NOT NULL,
    status VARCHAR(50) NOT NULL,
    comment VARCHAR(10000),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (order_id) REFERENCES orders(id) ON DELETE CASCADE
);

-- Order Items
CREATE TABLE IF NOT EXISTS order_items (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    order_id BIGINT NOT NULL,
    product_id BIGINT,
    variant_id BIGINT,
    name VARCHAR(255) NOT NULL,
    sku VARCHAR(100),
    quantity INTEGER NOT NULL,
    price DECIMAL(10,2) NOT NULL,
    total DECIMAL(10,2) NOT NULL,
    variant_title VARCHAR(255),
    FOREIGN KEY (order_id) REFERENCES orders(id) ON DELETE CASCADE,
    FOREIGN KEY (product_id) REFERENCES products(id) ON DELETE SET NULL,
    FOREIGN KEY (variant_id) REFERENCES product_variants(id) ON DELETE SET NULL
);

-- Carts Tabelle
CREATE TABLE IF NOT EXISTS carts (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    store_id BIGINT NOT NULL,
    user_id BIGINT,
    session_id VARCHAR(255) UNIQUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    expires_at TIMESTAMP,
    FOREIGN KEY (store_id) REFERENCES stores(id) ON DELETE CASCADE,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);

-- Cart Items
CREATE TABLE IF NOT EXISTS cart_items (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    cart_id BIGINT NOT NULL,
    product_id BIGINT NOT NULL,
    variant_id BIGINT,
    quantity INTEGER NOT NULL DEFAULT 1,
    price DECIMAL(10,2) NOT NULL,
    added_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (cart_id) REFERENCES carts(id) ON DELETE CASCADE,
    FOREIGN KEY (product_id) REFERENCES products(id) ON DELETE CASCADE,
    FOREIGN KEY (variant_id) REFERENCES product_variants(id) ON DELETE SET NULL
);

-- Coupons Tabelle
CREATE TABLE IF NOT EXISTS coupons (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    store_id BIGINT NOT NULL,
    code VARCHAR(50) NOT NULL,
    description VARCHAR(10000),
    discount_type VARCHAR(20) NOT NULL,
    discount_value DECIMAL(10,2) NOT NULL,
    min_purchase_amount DECIMAL(10,2),
    max_discount_amount DECIMAL(10,2),
    usage_limit INTEGER,
    usage_count INTEGER DEFAULT 0,
    per_customer_limit INTEGER,
    valid_from TIMESTAMP,
    valid_until TIMESTAMP,
    is_active BOOLEAN DEFAULT TRUE,
    applies_to VARCHAR(20) DEFAULT 'all',
    free_shipping BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (store_id) REFERENCES stores(id) ON DELETE CASCADE,
    UNIQUE(store_id, code)
);

-- Coupon Product IDs
CREATE TABLE IF NOT EXISTS coupon_product_ids (
    coupon_id BIGINT NOT NULL,
    product_id BIGINT NOT NULL,
    PRIMARY KEY (coupon_id, product_id),
    FOREIGN KEY (coupon_id) REFERENCES coupons(id) ON DELETE CASCADE,
    FOREIGN KEY (product_id) REFERENCES products(id) ON DELETE CASCADE
);

-- Coupon Category IDs
CREATE TABLE IF NOT EXISTS coupon_category_ids (
    coupon_id BIGINT NOT NULL,
    category_id BIGINT NOT NULL,
    PRIMARY KEY (coupon_id, category_id),
    FOREIGN KEY (coupon_id) REFERENCES coupons(id) ON DELETE CASCADE,
    FOREIGN KEY (category_id) REFERENCES categories(id) ON DELETE CASCADE
);

-- Coupon Collection IDs
CREATE TABLE IF NOT EXISTS coupon_collection_ids (
    coupon_id BIGINT NOT NULL,
    collection_id BIGINT NOT NULL,
    PRIMARY KEY (coupon_id, collection_id),
    FOREIGN KEY (coupon_id) REFERENCES coupons(id) ON DELETE CASCADE
);

-- Coupon Customer Emails
CREATE TABLE IF NOT EXISTS coupon_customer_emails (
    coupon_id BIGINT NOT NULL,
    email VARCHAR(255) NOT NULL,
    PRIMARY KEY (coupon_id, email),
    FOREIGN KEY (coupon_id) REFERENCES coupons(id) ON DELETE CASCADE
);

-- Coupon Domain IDs
CREATE TABLE IF NOT EXISTS coupon_domain_ids (
    coupon_id BIGINT NOT NULL,
    domain_id BIGINT NOT NULL,
    PRIMARY KEY (coupon_id, domain_id),
    FOREIGN KEY (coupon_id) REFERENCES coupons(id) ON DELETE CASCADE,
    FOREIGN KEY (domain_id) REFERENCES domains(id) ON DELETE CASCADE
);

-- Coupon Redemptions
CREATE TABLE IF NOT EXISTS coupon_redemptions (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    coupon_id BIGINT NOT NULL,
    order_id BIGINT,
    customer_email VARCHAR(255),
    discount_amount DECIMAL(10,2) NOT NULL,
    redeemed_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (coupon_id) REFERENCES coupons(id) ON DELETE CASCADE,
    FOREIGN KEY (order_id) REFERENCES orders(id) ON DELETE SET NULL
);

-- Store Themes
CREATE TABLE IF NOT EXISTS store_themes (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    store_id BIGINT NOT NULL UNIQUE,
    primary_color VARCHAR(7) DEFAULT '#000000',
    secondary_color VARCHAR(7) DEFAULT '#ffffff',
    accent_color VARCHAR(7) DEFAULT '#ff0000',
    font_family VARCHAR(100) DEFAULT 'Arial, sans-serif',
    logo_url VARCHAR(500),
    favicon_url VARCHAR(500),
    custom_css VARCHAR(10000),
    custom_js VARCHAR(10000),
    header_html VARCHAR(10000),
    footer_html VARCHAR(10000),
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (store_id) REFERENCES stores(id) ON DELETE CASCADE
);

-- Store Slider Settings
CREATE TABLE IF NOT EXISTS store_slider_settings (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    store_id BIGINT NOT NULL UNIQUE,
    override_mode VARCHAR(20) NOT NULL DEFAULT 'DEFAULT_ONLY',
    autoplay BOOLEAN NOT NULL DEFAULT TRUE,
    duration_ms INTEGER NOT NULL DEFAULT 5000,
    transition_ms INTEGER NOT NULL DEFAULT 500,
    loop_enabled BOOLEAN NOT NULL DEFAULT TRUE,
    show_dots BOOLEAN NOT NULL DEFAULT TRUE,
    show_arrows BOOLEAN NOT NULL DEFAULT TRUE,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (store_id) REFERENCES stores(id) ON DELETE CASCADE
);

-- Default Slider Images (Global default images for all stores)
CREATE TABLE IF NOT EXISTS default_slider_images (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    category VARCHAR(50) NOT NULL DEFAULT 'general',
    image_url VARCHAR(500) NOT NULL,
    alt_text VARCHAR(255),
    display_order INTEGER NOT NULL DEFAULT 0,
    is_active BOOLEAN NOT NULL DEFAULT TRUE,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

-- Store Slider Images
CREATE TABLE IF NOT EXISTS store_slider_images (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    store_id BIGINT NOT NULL,
    media_id BIGINT,
    image_url VARCHAR(500) NOT NULL,
    image_type VARCHAR(20) NOT NULL,
    display_order INTEGER NOT NULL DEFAULT 0,
    is_active BOOLEAN NOT NULL DEFAULT TRUE,
    alt_text VARCHAR(255),
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (store_id) REFERENCES stores(id) ON DELETE CASCADE,
    FOREIGN KEY (media_id) REFERENCES media(id) ON DELETE SET NULL
);

-- Customer Profiles
CREATE TABLE IF NOT EXISTS customer_profiles (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    user_id BIGINT NOT NULL UNIQUE,
    phone VARCHAR(50),
    billing_name VARCHAR(255),
    billing_address VARCHAR(500),
    billing_city VARCHAR(100),
    billing_zip VARCHAR(20),
    billing_country VARCHAR(100),
    shipping_name VARCHAR(255),
    shipping_address VARCHAR(500),
    shipping_city VARCHAR(100),
    shipping_zip VARCHAR(20),
    shipping_country VARCHAR(100),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);

-- Wishlists (Wunschlisten fuer Kunden)
CREATE TABLE IF NOT EXISTS wishlists (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    store_id BIGINT NOT NULL,
    customer_id BIGINT NOT NULL,
    name VARCHAR(255) NOT NULL DEFAULT 'Meine Wunschliste',
    description VARCHAR(10000),
    is_default BOOLEAN NOT NULL DEFAULT FALSE,
    is_public BOOLEAN NOT NULL DEFAULT FALSE,
    share_token VARCHAR(100) UNIQUE,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (store_id) REFERENCES stores(id) ON DELETE CASCADE,
    FOREIGN KEY (customer_id) REFERENCES users(id) ON DELETE CASCADE
);

-- Wishlist Items (Produkte in Wunschlisten)
CREATE TABLE IF NOT EXISTS wishlist_items (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    wishlist_id BIGINT NOT NULL,
    product_id BIGINT NOT NULL,
    variant_id BIGINT,
    priority VARCHAR(20) DEFAULT 'MEDIUM',
    note VARCHAR(10000),
    added_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (wishlist_id) REFERENCES wishlists(id) ON DELETE CASCADE,
    FOREIGN KEY (product_id) REFERENCES products(id) ON DELETE CASCADE,
    FOREIGN KEY (variant_id) REFERENCES product_variants(id) ON DELETE SET NULL,
    CONSTRAINT wishlist_items_unique UNIQUE (wishlist_id, product_id, variant_id)
);

-- Audit Logs
CREATE TABLE IF NOT EXISTS audit_logs (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    user_id BIGINT,
    store_id BIGINT,
    action VARCHAR(100) NOT NULL,
    entity_type VARCHAR(50),
    entity_id BIGINT,
    details VARCHAR(10000),
    ip_address VARCHAR(45),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE SET NULL,
    FOREIGN KEY (store_id) REFERENCES stores(id) ON DELETE CASCADE
);

-- Redirect Rules (SEO)
CREATE TABLE IF NOT EXISTS redirect_rules (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    store_id BIGINT NOT NULL,
    domain_id BIGINT,
    source_path VARCHAR(1000) NOT NULL,
    target_url VARCHAR(1000) NOT NULL,
    http_code INTEGER NOT NULL DEFAULT 301,
    is_regex BOOLEAN NOT NULL DEFAULT FALSE,
    priority INTEGER NOT NULL DEFAULT 100,
    is_active BOOLEAN NOT NULL DEFAULT TRUE,
    comment VARCHAR(500),
    tag VARCHAR(100),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (store_id) REFERENCES stores(id) ON DELETE CASCADE,
    FOREIGN KEY (domain_id) REFERENCES domains(id) ON DELETE SET NULL
);

-- Indizes fuer bessere Performance
CREATE INDEX IF NOT EXISTS idx_redirect_store ON redirect_rules(store_id);
CREATE INDEX IF NOT EXISTS idx_redirect_domain ON redirect_rules(domain_id);
CREATE INDEX IF NOT EXISTS idx_redirect_active ON redirect_rules(is_active);
CREATE INDEX IF NOT EXISTS idx_redirect_priority ON redirect_rules(priority);

CREATE INDEX IF NOT EXISTS idx_products_store ON products(store_id);
CREATE INDEX IF NOT EXISTS idx_products_category ON products(category_id);
CREATE INDEX IF NOT EXISTS idx_products_status ON products(status);

CREATE INDEX IF NOT EXISTS idx_orders_store ON orders(store_id);
CREATE INDEX IF NOT EXISTS idx_orders_customer ON orders(customer_id);
CREATE INDEX IF NOT EXISTS idx_orders_status ON orders(status);
CREATE INDEX IF NOT EXISTS idx_orders_created ON orders(created_at);

CREATE INDEX IF NOT EXISTS idx_carts_store ON carts(store_id);
CREATE INDEX IF NOT EXISTS idx_carts_user ON carts(user_id);
CREATE INDEX IF NOT EXISTS idx_carts_session ON carts(session_id);

-- Product Reviews
CREATE TABLE IF NOT EXISTS product_reviews (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    product_id BIGINT NOT NULL,
    customer_id BIGINT NOT NULL,
    order_id BIGINT,
    rating INTEGER NOT NULL CHECK (rating >= 1 AND rating <= 5),
    title VARCHAR(200),
    comment TEXT,
    is_verified_purchase BOOLEAN NOT NULL DEFAULT FALSE,
    is_approved BOOLEAN NOT NULL DEFAULT FALSE,
    helpful_count INTEGER NOT NULL DEFAULT 0,
    not_helpful_count INTEGER NOT NULL DEFAULT 0,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP,
    approved_at TIMESTAMP,
    approved_by BIGINT,
    FOREIGN KEY (product_id) REFERENCES products(id) ON DELETE CASCADE,
    FOREIGN KEY (customer_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (order_id) REFERENCES orders(id) ON DELETE SET NULL,
    FOREIGN KEY (approved_by) REFERENCES users(id) ON DELETE SET NULL
);

-- Review Votes
CREATE TABLE IF NOT EXISTS review_votes (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    review_id BIGINT NOT NULL,
    user_id BIGINT NOT NULL,
    is_helpful BOOLEAN NOT NULL,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (review_id) REFERENCES product_reviews(id) ON DELETE CASCADE,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    UNIQUE (review_id, user_id)
);

CREATE INDEX IF NOT EXISTS idx_review_product ON product_reviews(product_id);
CREATE INDEX IF NOT EXISTS idx_review_customer ON product_reviews(customer_id);
CREATE INDEX IF NOT EXISTS idx_review_approved ON product_reviews(is_approved, created_at);
CREATE INDEX IF NOT EXISTS idx_vote_review ON review_votes(review_id);
CREATE INDEX IF NOT EXISTS idx_vote_user ON review_votes(user_id);

-- Default Daten einfuegen
INSERT INTO plans (name, max_stores, max_custom_domains, max_subdomains, max_storage_mb, max_products, max_image_count)
VALUES
    ('FREE', 1, 0, 1, 100, 10, 20),
    ('STARTER', 3, 1, 5, 1000, 100, 200),
    ('BUSINESS', 10, 5, 20, 10000, 1000, 2000),
    ('ENTERPRISE', 100, 50, 100, 100000, 10000, 20000)
ON CONFLICT (name) DO NOTHING;

-- Default Slider Images (Idempotent INSERT)
WITH seed (category, image_url, alt_text, display_order) AS (
    VALUES
        ('general', 'https://images.unsplash.com/photo-1607082348824-0a96f2a4b9da?w=1200&h=400&fit=crop', 'Willkommen im Shop', 1),
        ('general', 'https://images.unsplash.com/photo-1472851294608-062f824d29cc?w=1200&h=400&fit=crop', 'Neue Angebote', 2),
        ('general', 'https://images.unsplash.com/photo-1523726491678-bf852e717f6a?w=1200&h=400&fit=crop', 'Premium Produkte', 3),
        ('fashion', 'https://images.unsplash.com/photo-1445205170230-053b83016050?w=1200&h=400&fit=crop', 'Fashion Collection', 1),
        ('fashion', 'https://images.unsplash.com/photo-1483985988355-763728e1935b?w=1200&h=400&fit=crop', 'Style & Trends', 2),
        ('electronics', 'https://images.unsplash.com/photo-1550745165-9bc0b252726f?w=1200&h=400&fit=crop', 'Tech Innovation', 1),
        ('electronics', 'https://images.unsplash.com/photo-1498049794561-7780e7231661?w=1200&h=400&fit=crop', 'Latest Gadgets', 2),
        ('food', 'https://images.unsplash.com/photo-1504674900247-0877df9cc836?w=1200&h=400&fit=crop', 'Frische Zutaten', 1),
        ('food', 'https://images.unsplash.com/photo-1476224203421-9ac39bcb3327?w=1200&h=400&fit=crop', 'Leckere Gerichte', 2)
)
INSERT INTO default_slider_images (category, image_url, alt_text, display_order)
SELECT s.category, s.image_url, s.alt_text, s.display_order
FROM seed s
WHERE NOT EXISTS (
    SELECT 1
    FROM default_slider_images d
    WHERE d.category = s.category AND d.image_url = s.image_url
);

-- =============================================
-- CHATBOT & CUSTOMER SUPPORT SYSTEM
-- =============================================

-- Chat Sessions (Conversation between customer and store)
CREATE TABLE IF NOT EXISTS chat_sessions (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    store_id BIGINT NOT NULL,
    customer_id BIGINT,
    session_token VARCHAR(255) UNIQUE NOT NULL,
    customer_name VARCHAR(255),
    customer_email VARCHAR(255),
    status VARCHAR(20) NOT NULL DEFAULT 'ACTIVE', -- ACTIVE, CLOSED, TRANSFERRED
    channel VARCHAR(20) NOT NULL DEFAULT 'CHATBOT', -- CHATBOT, LIVE_CHAT, EMAIL
    assigned_agent_id BIGINT,
    language VARCHAR(10) DEFAULT 'de',
    user_agent VARCHAR(500),
    ip_address VARCHAR(50),
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    closed_at TIMESTAMP,
    FOREIGN KEY (store_id) REFERENCES stores(id) ON DELETE CASCADE,
    FOREIGN KEY (customer_id) REFERENCES users(id) ON DELETE SET NULL,
    FOREIGN KEY (assigned_agent_id) REFERENCES users(id) ON DELETE SET NULL
);

CREATE INDEX IF NOT EXISTS idx_chat_session_store ON chat_sessions(store_id, status);
CREATE INDEX IF NOT EXISTS idx_chat_session_customer ON chat_sessions(customer_id);
CREATE INDEX IF NOT EXISTS idx_chat_session_token ON chat_sessions(session_token);

-- Chat Messages
CREATE TABLE IF NOT EXISTS chat_messages (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    session_id BIGINT NOT NULL,
    sender_type VARCHAR(20) NOT NULL, -- CUSTOMER, AGENT, BOT
    sender_id BIGINT,
    sender_name VARCHAR(255),
    message_type VARCHAR(20) NOT NULL DEFAULT 'TEXT', -- TEXT, IMAGE, FILE, ORDER_LINK, PRODUCT_LINK
    content VARCHAR(5000) NOT NULL,
    metadata VARCHAR(2000), -- JSON: {orderId, productId, fileUrl, etc}
    is_read BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (session_id) REFERENCES chat_sessions(id) ON DELETE CASCADE,
    FOREIGN KEY (sender_id) REFERENCES users(id) ON DELETE SET NULL
);

CREATE INDEX IF NOT EXISTS idx_chat_message_session ON chat_messages(session_id, created_at);
CREATE INDEX IF NOT EXISTS idx_chat_message_unread ON chat_messages(session_id, is_read);

-- FAQ Knowledge Base
CREATE TABLE IF NOT EXISTS faq_categories (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    store_id BIGINT,
    name VARCHAR(255) NOT NULL,
    slug VARCHAR(255) NOT NULL,
    description VARCHAR(1000),
    icon VARCHAR(50),
    display_order INTEGER DEFAULT 0,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (store_id) REFERENCES stores(id) ON DELETE CASCADE,
    UNIQUE (store_id, slug)
);

CREATE INDEX IF NOT EXISTS idx_faq_category_store ON faq_categories(store_id, is_active);

-- FAQ Questions & Answers
CREATE TABLE IF NOT EXISTS faq_items (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    category_id BIGINT NOT NULL,
    store_id BIGINT,
    question VARCHAR(500) NOT NULL,
    answer VARCHAR(5000) NOT NULL,
    keywords VARCHAR(1000), -- Comma-separated keywords for search
    display_order INTEGER DEFAULT 0,
    view_count INTEGER DEFAULT 0,
    helpful_count INTEGER DEFAULT 0,
    language VARCHAR(10) DEFAULT 'de',
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (category_id) REFERENCES faq_categories(id) ON DELETE CASCADE,
    FOREIGN KEY (store_id) REFERENCES stores(id) ON DELETE CASCADE
);

CREATE INDEX IF NOT EXISTS idx_faq_item_category ON faq_items(category_id, is_active);
CREATE INDEX IF NOT EXISTS idx_faq_item_store ON faq_items(store_id, is_active);

-- Canned Responses (Quick Replies for Agents)
CREATE TABLE IF NOT EXISTS canned_responses (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    store_id BIGINT NOT NULL,
    shortcut VARCHAR(50) NOT NULL,
    title VARCHAR(255) NOT NULL,
    message VARCHAR(2000) NOT NULL,
    category VARCHAR(100),
    usage_count INTEGER DEFAULT 0,
    is_active BOOLEAN DEFAULT TRUE,
    created_by BIGINT,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (store_id) REFERENCES stores(id) ON DELETE CASCADE,
    FOREIGN KEY (created_by) REFERENCES users(id) ON DELETE SET NULL,
    UNIQUE (store_id, shortcut)
);

CREATE INDEX IF NOT EXISTS idx_canned_response_store ON canned_responses(store_id, is_active);

-- Chat Bot Intents (AI Training Data)
CREATE TABLE IF NOT EXISTS chatbot_intents (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    store_id BIGINT,
    intent_name VARCHAR(100) NOT NULL,
    description VARCHAR(500),
    training_phrases VARCHAR(5000), -- JSON array of example phrases
    response_template VARCHAR(2000),
    action VARCHAR(50), -- CHECK_ORDER, SHOW_FAQ, TRANSFER_TO_AGENT, etc
    confidence_threshold DECIMAL(3,2) DEFAULT 0.7,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (store_id) REFERENCES stores(id) ON DELETE CASCADE,
    UNIQUE (intent_name)
);

CREATE INDEX IF NOT EXISTS idx_chatbot_intent_store ON chatbot_intents(store_id, is_active);

-- Chat Analytics
CREATE TABLE IF NOT EXISTS chat_analytics (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    store_id BIGINT NOT NULL,
    date DATE NOT NULL,
    total_sessions INTEGER DEFAULT 0,
    bot_resolved INTEGER DEFAULT 0,
    agent_transferred INTEGER DEFAULT 0,
    avg_response_time_seconds INTEGER DEFAULT 0,
    customer_satisfaction_score DECIMAL(3,2), -- 0.00 to 5.00
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (store_id) REFERENCES stores(id) ON DELETE CASCADE,
    UNIQUE (store_id, date)
);

CREATE INDEX IF NOT EXISTS idx_chat_analytics_store_date ON chat_analytics(store_id, date);

-- Default FAQ Categories (Global)
INSERT INTO faq_categories (store_id, name, slug, description, icon, display_order)
VALUES
    (NULL, 'Bestellung & Lieferung', 'order-delivery', 'Fragen zu Bestellungen und Versand', 'ðŸ“¦', 1),
    (NULL, 'Zahlung & RÃ¼ckerstattung', 'payment-refund', 'Zahlungsmethoden und RÃ¼ckgaben', 'ðŸ’³', 2),
    (NULL, 'Produkte & VerfÃ¼gbarkeit', 'products-availability', 'Produktinformationen und Lagerbestand', 'ðŸ›ï¸', 3),
    (NULL, 'Konto & Datenschutz', 'account-privacy', 'Account-Verwaltung und Datenschutz', 'ðŸ‘¤', 4),
    (NULL, 'Allgemeine Fragen', 'general', 'Sonstige hÃ¤ufig gestellte Fragen', 'â“', 5)
ON CONFLICT (store_id, slug) DO NOTHING;

-- Default FAQ Items (Global)
WITH faq_seed AS (
    SELECT
        c.id as category_id,
        q.question,
        q.answer,
        q.keywords,
        q.display_order
    FROM faq_categories c
    CROSS JOIN (
        VALUES
            -- Order & Delivery
            ('Wie kann ich meine Bestellung verfolgen?',
             'Sie kÃ¶nnen Ihre Bestellung jederzeit Ã¼ber die Bestellnummer verfolgen. Nutzen Sie dazu unseren Chat und geben Sie einfach Ihre Bestellnummer ein.',
             'bestellung,verfolgen,tracking,sendung,lieferung',
             1),
            ('Wie lange dauert die Lieferung?',
             'Die Lieferzeit betrÃ¤gt in der Regel 2-5 Werktage innerhalb Deutschlands. Express-Versand ist ebenfalls verfÃ¼gbar.',
             'lieferzeit,dauer,versand,express',
             2),
            ('Was kostet der Versand?',
             'Der Standardversand kostet 4,99â‚¬. Ab einem Bestellwert von 50â‚¬ ist der Versand kostenlos.',
             'versandkosten,lieferkosten,kostenlos,gratis',
             3),
            -- Payment & Refund
            ('Welche Zahlungsmethoden werden akzeptiert?',
             'Wir akzeptieren Kreditkarte, PayPal, SOFORT, Lastschrift und Nachnahme.',
             'zahlung,bezahlen,payment,kreditkarte,paypal',
             1),
            ('Kann ich meine Bestellung stornieren?',
             'Ja, Sie kÃ¶nnen Ihre Bestellung innerhalb von 2 Stunden nach Aufgabe stornieren. Kontaktieren Sie uns Ã¼ber den Chat.',
             'stornieren,abbrechen,cancel,zurÃ¼ckgeben',
             2),
            ('Wie funktioniert die RÃ¼ckgabe?',
             'Sie haben 14 Tage RÃ¼ckgaberecht. Bitte nutzen Sie das RÃ¼ckgabeformular in Ihrem Kundenkonto.',
             'rÃ¼ckgabe,zurÃ¼cksenden,return,widerrufsrecht',
             3),
            -- Products
            ('Ist das Produkt auf Lager?',
             'Sie sehen die VerfÃ¼gbarkeit direkt auf der Produktseite. Bei Fragen zu spezifischen Produkten kontaktieren Sie uns Ã¼ber den Chat.',
             'verfÃ¼gbarkeit,lagerbestand,stock,vorrÃ¤tig',
             1),
            ('Gibt es Mengenrabatte?',
             'Ja, ab 5 StÃ¼ck desselben Produkts gewÃ¤hren wir automatisch 10% Rabatt.',
             'rabatt,discount,mengenrabatt,bulk',
             2),
            -- Account
            ('Wie erstelle ich ein Konto?',
             'Klicken Sie oben rechts auf "Anmelden" und dann auf "Registrieren". Sie benÃ¶tigen nur eine E-Mail-Adresse.',
             'konto,account,registrieren,anmelden',
             1),
            ('Ich habe mein Passwort vergessen',
             'Klicken Sie auf "Passwort vergessen?" auf der Login-Seite. Sie erhalten dann eine E-Mail zum ZurÃ¼cksetzen.',
             'passwort,password,vergessen,reset',
             2)
    ) AS q(question, answer, keywords, display_order)
    WHERE c.store_id IS NULL
      AND (
          (c.slug = 'order-delivery' AND q.display_order <= 3 AND q.keywords LIKE '%bestellung%')
          OR (c.slug = 'payment-refund' AND q.display_order <= 3 AND q.keywords LIKE '%zahlung%')
          OR (c.slug = 'products-availability' AND q.display_order <= 2 AND q.keywords LIKE '%verfÃ¼gbarkeit%')
          OR (c.slug = 'account-privacy' AND q.display_order <= 2 AND q.keywords LIKE '%konto%')
      )
)
INSERT INTO faq_items (category_id, store_id, question, answer, keywords, display_order)
SELECT category_id, NULL, question, answer, keywords, display_order
FROM faq_seed
WHERE NOT EXISTS (
    SELECT 1 FROM faq_items f
    WHERE f.question = faq_seed.question
);

-- Default Chatbot Intents
INSERT INTO chatbot_intents (store_id, intent_name, description, training_phrases, response_template, action)
VALUES
    (NULL, 'greeting', 'BegrÃ¼ÃŸung',
     '["hallo","hi","guten tag","hey","servus","moin"]',
     'Hallo! ðŸ‘‹ Wie kann ich Ihnen heute helfen?',
     'SHOW_MENU'),
    (NULL, 'order_status', 'Bestellstatus abfragen',
     '["wo ist meine bestellung","bestellung verfolgen","tracking","sendungsverfolgung","bestellnummer"]',
     'Gerne helfe ich Ihnen bei der Verfolgung Ihrer Bestellung. Bitte geben Sie Ihre Bestellnummer ein.',
     'CHECK_ORDER'),
    (NULL, 'faq_request', 'FAQ anfordern',
     '["hÃ¤ufige fragen","faq","hilfe","support","frage"]',
     'Hier sind unsere hÃ¤ufigsten Fragen. Was interessiert Sie?',
     'SHOW_FAQ'),
    (NULL, 'human_request', 'Menschlicher Agent angefordert',
     '["mitarbeiter","agent","person","mensch","jemand sprechen"]',
     'Ich verbinde Sie mit einem unserer Mitarbeiter. Einen Moment bitte...',
     'TRANSFER_TO_AGENT'),
    (NULL, 'goodbye', 'Verabschiedung',
     '["tschÃ¼ss","auf wiedersehen","bye","danke","ciao"]',
     'Vielen Dank! Bei Fragen stehe ich Ihnen jederzeit zur VerfÃ¼gung. ðŸ˜Š',
     'END_SESSION')
ON CONFLICT (intent_name) DO NOTHING;


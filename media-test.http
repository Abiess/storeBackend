### API Testing - Media & MinIO Integration

### === PREREQUISITES ===
### 1. Make sure MinIO is running on localhost:9000
### 2. Register and login first to get auth token
### 3. Create a store to get store_id

### 1. Benutzer registrieren (bekommt automatisch FREE Plan)
POST http://localhost:8080/api/auth/register
Content-Type: application/json

{
  "email": "mediatest@example.com",
  "password": "Test123!"
}

###

### 2. Benutzer anmelden
POST http://localhost:8080/api/auth/login
Content-Type: application/json

{
  "email": "mediatest@example.com",
  "password": "Test123!"
}

> {%
    client.global.set("auth_token", response.body.token);
    client.global.set("user_id", response.body.userId);
%}

###

### 3. Store erstellen
POST http://localhost:8080/api/me/stores
Content-Type: application/json
Authorization: Bearer {{auth_token}}

{
  "name": "Media Test Shop",
  "slug": "mediatest"
}

> {%
    client.global.set("store_id", response.body.id);
%}

###

### === MEDIA MANAGEMENT ===

### 4. Store Usage Statistics abrufen (vor Upload)
GET http://localhost:8080/api/stores/{{store_id}}/media/usage
Authorization: Bearer {{auth_token}}

###

### 5. Bild hochladen (Product Image)
POST http://localhost:8080/api/stores/{{store_id}}/media/upload
Authorization: Bearer {{auth_token}}
Content-Type: multipart/form-data; boundary=WebAppBoundary

--WebAppBoundary
Content-Disposition: form-data; name="file"; filename="product1.jpg"
Content-Type: image/jpeg

< C:/path/to/your/test-image.jpg
--WebAppBoundary
Content-Disposition: form-data; name="mediaType"

PRODUCT_IMAGE
--WebAppBoundary
Content-Disposition: form-data; name="altText"

Beautiful product image
--WebAppBoundary--

> {%
    client.global.set("media_id", response.body.mediaId);
%}

###

### 6. Store Logo hochladen
POST http://localhost:8080/api/stores/{{store_id}}/media/upload
Authorization: Bearer {{auth_token}}
Content-Type: multipart/form-data; boundary=WebAppBoundary

--WebAppBoundary
Content-Disposition: form-data; name="file"; filename="logo.png"
Content-Type: image/png

< C:/path/to/your/logo.png
--WebAppBoundary
Content-Disposition: form-data; name="mediaType"

STORE_LOGO
--WebAppBoundary
Content-Disposition: form-data; name="altText"

Store Logo
--WebAppBoundary--

###

### 7. Alle Media des Stores abrufen
GET http://localhost:8080/api/stores/{{store_id}}/media
Authorization: Bearer {{auth_token}}

###

### 8. Media URL abrufen (presigned URL)
GET http://localhost:8080/api/stores/{{store_id}}/media/{{media_id}}/url
Authorization: Bearer {{auth_token}}

###

### 9. Store Usage Statistics abrufen (nach Upload)
GET http://localhost:8080/api/stores/{{store_id}}/media/usage
Authorization: Bearer {{auth_token}}

###

### 10. Media löschen
DELETE http://localhost:8080/api/stores/{{store_id}}/media/{{media_id}}
Authorization: Bearer {{auth_token}}

###

### === ERROR TESTING ===

### 11. Fehler: Upload ohne Authentifizierung
POST http://localhost:8080/api/stores/{{store_id}}/media/upload
Content-Type: multipart/form-data; boundary=WebAppBoundary

--WebAppBoundary
Content-Disposition: form-data; name="file"; filename="test.jpg"
Content-Type: image/jpeg

< C:/path/to/your/test-image.jpg
--WebAppBoundary--

###

### 12. Fehler: Media für fremden Store abrufen
GET http://localhost:8080/api/stores/999/media
Authorization: Bearer {{auth_token}}

###

### 13. Fehler: Zu große Datei hochladen (>10MB wird abgelehnt)
POST http://localhost:8080/api/stores/{{store_id}}/media/upload
Authorization: Bearer {{auth_token}}
Content-Type: multipart/form-data; boundary=WebAppBoundary

--WebAppBoundary
Content-Disposition: form-data; name="file"; filename="huge-file.jpg"
Content-Type: image/jpeg

< C:/path/to/your/large-file.jpg
--WebAppBoundary--

###

### === STRESS TEST: Multiple Uploads ===

### 14. Mehrere Bilder hochladen (Storage Limit testen)
### Wiederholen Sie diesen Request mehrmals, um das FREE Plan Limit (100 MB) zu erreichen
POST http://localhost:8080/api/stores/{{store_id}}/media/upload
Authorization: Bearer {{auth_token}}
Content-Type: multipart/form-data; boundary=WebAppBoundary

--WebAppBoundary
Content-Disposition: form-data; name="file"; filename="product-batch.jpg"
Content-Type: image/jpeg

< C:/path/to/your/test-image.jpg
--WebAppBoundary
Content-Disposition: form-data; name="mediaType"

PRODUCT_IMAGE
--WebAppBoundary--

###

### === INTEGRATION WITH EXISTING ENDPOINTS ===

### 15. Store mit allen Details abrufen
GET http://localhost:8080/api/me/stores
Authorization: Bearer {{auth_token}}

###

### 16. User Info mit Plan Details abrufen
GET http://localhost:8080/api/auth/me
Authorization: Bearer {{auth_token}}

###


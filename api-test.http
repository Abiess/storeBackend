### API Testing mit IntelliJ IDEA / VS Code HTTP Client - Multi-Tenant SaaS

### 1. Benutzer registrieren (bekommt automatisch FREE Plan)
POST http://localhost:8080/api/auth/register
Content-Type: application/json

{
  "email": "test@example.com",
  "password": "Test123!"
}

###

### 2. Benutzer anmelden
POST http://localhost:8080/api/auth/login
Content-Type: application/json

{
  "email": "test@example.com",
  "password": "Test123!"
}

> {%
    client.global.set("auth_token", response.body.token);
    client.global.set("user_id", response.body.userId);
%}

###

### 3. Aktuellen Benutzer abrufen
GET http://localhost:8080/api/auth/me
Authorization: Bearer {{auth_token}}

###

### 4. Store erstellen (erstellt automatisch Subdomain coolshop.markt.ma)
POST http://localhost:8080/api/me/stores
Content-Type: application/json
Authorization: Bearer {{auth_token}}

{
  "name": "Cool Shop",
  "slug": "coolshop"
}

> {%
    client.global.set("store_id", response.body.id);
%}

###

### 5. Alle Stores des Benutzers abrufen
GET http://localhost:8080/api/me/stores
Authorization: Bearer {{auth_token}}

###

### === DOMAIN MANAGEMENT (NEU) ===

### 6. Domains des Stores abrufen (sollte automatisch erstellte Subdomain zeigen)
GET http://localhost:8080/api/stores/{{store_id}}/domains
Authorization: Bearer {{auth_token}}

###

### 7. Zusätzliche Subdomain erstellen
POST http://localhost:8080/api/stores/{{store_id}}/domains/subdomain
Authorization: Bearer {{auth_token}}

###

### 8. Custom Domain hinzufügen
POST http://localhost:8080/api/stores/{{store_id}}/domains/custom
Content-Type: application/json
Authorization: Bearer {{auth_token}}

{
  "host": "shop.customer-domain.com"
}

> {%
    client.global.set("custom_domain_id", response.body.id);
%}

###

### 9. Verifikations-Anweisungen für Custom Domain abrufen
GET http://localhost:8080/api/stores/{{store_id}}/domains/{{custom_domain_id}}/verification-instructions
Authorization: Bearer {{auth_token}}

###

### 10. Custom Domain verifizieren (simuliert DNS-Check)
POST http://localhost:8080/api/stores/{{store_id}}/domains/{{custom_domain_id}}/verify
Authorization: Bearer {{auth_token}}

###

### 11. Custom Domain als Primary setzen
POST http://localhost:8080/api/stores/{{store_id}}/domains/{{custom_domain_id}}/set-primary
Authorization: Bearer {{auth_token}}

###

### === PUBLIC STORE RESOLUTION (für Frontend) ===

### 12. Store über Host auflösen (für Subdomain)
GET http://localhost:8080/api/public/store/resolve?host=coolshop.markt.ma

###

### 13. Store über Slug auflösen
GET http://localhost:8080/api/public/store/by-slug/coolshop

###

### 14. Store Resolution mit Host Header (simuliert echte Browser-Anfrage)
GET http://localhost:8080/api/public/store/resolve
Host: coolshop.markt.ma

###

### 15. Domain-Verfügbarkeit prüfen (Subdomain)
GET http://localhost:8080/api/public/domain/check-availability?host=newshop.markt.ma

###

### 16. Domain-Verfügbarkeit prüfen (Custom Domain)
GET http://localhost:8080/api/public/domain/check-availability?host=my-custom-shop.com

###

### === PRODUCT MANAGEMENT ===

### 17. Produkt erstellen
POST http://localhost:8080/api/stores/{{store_id}}/products
Content-Type: application/json
Authorization: Bearer {{auth_token}}

{
  "title": "Test Produkt",
  "description": "Ein tolles Test-Produkt",
  "basePrice": 29.99,
  "status": "ACTIVE"
}

> {%
    client.global.set("product_id", response.body.id);
%}

###

### 18. Alle Produkte des Stores abrufen
GET http://localhost:8080/api/stores/{{store_id}}/products
Authorization: Bearer {{auth_token}}

###

### 19. Einzelnes Produkt abrufen
GET http://localhost:8080/api/stores/{{store_id}}/products/{{product_id}}
Authorization: Bearer {{auth_token}}

###

### 20. Produkt aktualisieren
PUT http://localhost:8080/api/stores/{{store_id}}/products/{{product_id}}
Content-Type: application/json
Authorization: Bearer {{auth_token}}

{
  "title": "Aktualisiertes Test Produkt",
  "description": "Ein noch tolleres Test-Produkt",
  "basePrice": 39.99,
  "status": "ACTIVE"
}

###

### === ERROR TESTING ===

### 21. Fehler: Store ohne gültigen JWT erstellen
POST http://localhost:8080/api/me/stores
Content-Type: application/json

{
  "name": "Unauthorized Shop",
  "slug": "unauthorized"
}

###

### 22. Fehler: Domain für fremden Store verwalten
GET http://localhost:8080/api/stores/999/domains
Authorization: Bearer {{auth_token}}

###

### 23. Fehler: Ungültigen Slug verwenden
POST http://localhost:8080/api/me/stores
Content-Type: application/json
Authorization: Bearer {{auth_token}}

{
  "name": "Invalid Slug Shop",
  "slug": "invalid_slug_with_underscores!"
}

###

### 24. Fehler: Bereits existierende Subdomain
POST http://localhost:8080/api/me/stores
Content-Type: application/json
Authorization: Bearer {{auth_token}}

{
  "name": "Duplicate Shop",
  "slug": "coolshop"
}

###
